<html>
<head>
<link rel="stylesheet" type="text/css" href="scripts/c3.css" >
<link rel="stylesheet" type="text/css" href="scripts/datatables.css"/>

<script type="text/javascript" src="scripts/c3.js"></script>
<script type="text/javascript" src="scripts/d3.min.js" charset="utf-8"></script>
<script type="text/javascript" src="scripts/datatables.min.js"></script>

<style>
#overlay {
    position: absolute;
    display: none;
    width: 100%;
    height: 100%;
    top: 50%;
    left: 50%;
    right: 0;
    bottom: 0;
    background-color: white; 
    z-index: 2;
    cursor: pointer;
}
</style>
</head>
<body>
<script>

var openFile = function(event) {
    var input = event.target;

    var reader = new FileReader();
    reader.onload = function(){
      var $table = $("#results");
      var text = reader.result;
      
        text.split("\n").forEach(function(row,rowIndex){
           if(row.length<5){
               return;
           }
          
           var $line = $("<tr></tr>")     
            row.split("\t").forEach(function(col,colIndex){
                $line.append($("<td></td>").html(col))
            });
            
        $table.append($line)
        });
        
        
        $table.prepend('<thead></thead>')
        $table.find('thead').append($table.find("tr:eq(0)"))

        $table.find('thead').find("td").each(function(x,y){ 
            val=y.innerText;
            $('#dim1').append($('<option>', {value:x, text:val}));
            $('#dim2').append($('<option>', {value:x, text:val}));
        });
        



        $table.appendTo(document.body);
        $table.DataTable({
            colReorder: true,
            paging:         false,
            scrollY:        300,
            scrollX:        true,
            scrollCollapse: true,
            fixedColumns:   true,
            keys:           true,
            dom: 'Bfrtip',
            buttons: [
            {
                extend: 'copy',
                exportOptions: {
                    columns: ':visible'
                }
            }, 'colvis'],
                columnDefs: [ {
            visible: false
                } ]
            
            });


         
      $('#results tbody').on('click', 'tr', function () {
        var  table =  $('#results').DataTable();
        fname=table.row(this).data()[1] + "\\" + table.row(this).data()[0] + "_thumb.png";
        $("#overlay_image")[0].src=fname;
        overlay_on();
    } );


    };
        reader.readAsText(input.files[0]);
 };



function overlay_on() {
    document.getElementById("overlay").style.display = "block";
}

function overlay_off() {
    document.getElementById("overlay").style.display = "none";
}

function drawGraph(){
    var table = $('#results').DataTable();
    dim1=$('#dim1').val();
    dim2=$('#dim2').val();
    data=table.columns([0,dim1]).data().toArray()
    //json_data=JSON.stringify(data)
    var chart = c3.generate({
    bindto: '#chart',
    data:{
        rows: data,
        type: 'bar'
    }

});
}


</script>


<input type='file' accept=".tsv" onchange='openFile(event)'><br>


<div id="overlay" onclick="overlay_off()">
  <div id="img"><img id="overlay_image" src=""></div>
</div>

<table id='results' class='display' width='10000px'><tbody></tbody></table>



Dimension 1: <select id="dim1" onchange="drawGraph()">  </select> <br>
Dimension 2: <select id="dim2">  </select>

<input type=button value="Draw" onclick='drawGraph()'>

</body>
<div id="chart"></div>
</html>
